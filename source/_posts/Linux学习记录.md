---
title: Linux学习记录
date: 2016-09-15 22:42:28
tags: Operating System
categories: 'Javascript'
---
# 一、 远程登录：
```bash 
ssh username@host
```
# 二、 用户
##   2.1 切换用户

>切换到root用户：
* su ：切换用户状态，但不切换终端
* su -：切换用户状态，并切换终端
* sudo：使用管理员用户身份运行命令

>切换到普通用户：
* su username
* su - username

## 2.2查看用户信息
* id：显示当前用户信息
* passwd：修改当前用户密码

<!-- more -->

# 三、 基本命令
## 3.1 补全
* tab一次补全命令(不能补全参数)
* tab两次列出以输入字符开头的命令

## 3.2 重复操作
* !!或上键：重复上次操作
* !字符：重复前一个以‘字符’开头的命令
* !数字：按历史记录序号执行命令
* !?abc:重复之前包含abc的命令
* !-n:重复n个命令之前的那个命令
一般在编写脚本的时候使用。

## 3.3 通配符
* `*`匹配0个或多个
* `?`匹配任意一个字符
* `[0-9]`匹配一个数字范围
* `[abc]`匹配列表里（abc）任意字符
* `[^abc]`匹配列表以外任意字符

## 3.4 快捷键
* Ctrl+r 历史命令搜索
* esc . 调用前一个命令的参数

# 四、 BASH作业管理
* &：在命令后加`&`表示后台运行此程序
* Ctrl+z：暂停某程序运行
* sleep 时间参数:
* jobs：查看当前正在运行的进程
* bg 数字：恢复运行
* fg 数字：将后台作业拉回前台来

# 五、 Linux文件系统结构

* Linux系统作为一个倒转的单根树状结构
* 文件根为`/`
* 文件系统严格区分大小写
* 路径使用`/`分割（windows使用`\`分割）


## 5.1 目录
* pwd：显示当前目录

## 5.2 文件名称
* 文件名称大小写敏感
* 名称最多255个字符
* 除`/`以外都是有效字符
* 通过touch命令创建和更新文件(更新文件创建时间)
* 以`.`开头的文件是隐藏文件
* 隐藏文件多数是配置文件
* file 查看文件类型
* ls参数：
  1. -a 所有文件（包括隐藏文件、目录）
  2. -l 以列表形式显示非隐藏文件、目录的详细信息
  3. -R 以结构化形式递归显示目录的子目录结构
  4. ld 显示目录的信息

## 5.3 路径使用
1. 绝对路径：以`/`开始，递归每级，不受当前工作路径限制  
2. 相对路径：以当前目录为起点受当前工作路径限制
3. 当前目录：.
4. 上级目录：..
5. 家目录：~ （cd）
6. 上一个工作目录：-
在写脚本的时候一般使用绝对路径

## 5.4 文件、目录操作
* cp：复制文件、目录（使用：cp 【参数】 源 目标目录）
  -r 递归复制复制文件夹
  -v 显示复制过程详细信息（使用：cp 【参数】 源 目标目录）
* mv： 移动、重命名（使用：cp 【参数】 源 目标目录/newname）不指定目录就是在当前目录重命名
* rm：删除
  1. -r递归删除文件夹子目录
  2. -i交互式递归删除
  3. -f强制删除所有，掩盖-i参数
* mkdir：创建目录
* rmdir：删除目录（不能删除非空目录，删除非空目录使用rm -r）

# 六、 Linux系统目录
## bin
* 常用的可执行的二进制文件，所有用户都有权限执行

## boot
* 引导目录（系统启动）
* vmlinuz是操作系统内核（uname命令可看到相关信息）

## dev
* 被抽象成文件的计算机上所有硬件设备（sd：硬盘 tty：终端）

## etc
* 配置文件
* 纯文本文件

## home
* 家目录 
* 保存每个用户的家目录（用户私有文件）

## root
* root用户的家目录

## lib
* 程序运行的库文件（相当于windows里的.dll文件）

## media mnt
* 挂载文件夹

## opt
* 通常用来装大型软件

## proc 
* 系统的实时信息
* 不存在于硬盘上，只存在于内存
* 虚拟文件夹
* cpu信息：cpuinfo
* 内存信息：meminfo
* 以数字命名的文件夹对应每一个进程
* 查看I/O、启动时间、硬盘参数、电源……

## sbin
* 只有root用户才能执行

## selinux
* 安全机制相关

## sys
* 系统底层信息

## tmp
* 临时目录
* 定时自动删除

## user
* 一般应用软件安装位置

## var
* 通常保存服务器信息
* log操作系统日志信息
* 一般保存变化的信息
* 例如邮件

# 七、 常用命令

## 日期时间
 1. date 当前系统时间
 2. date -u 
 3. date +%Y--%m--%d+格式化显示时间（`--`可以随意定义）
 4. date -s 设置时间
 5. hwclock(click) 硬件时间
 6. cal 日历
 7. uptime 查看系统运行时间、系统负载（1m 5m 10m）

## 输出、查看
 1. echo 输出
 2. cat 查看文件内容
 3. more 翻页形式显示文件，只能向下翻页（空格）
 4. less 翻页形式显示文件，能上下翻页（上下键、pageup/down）
 5. head 显示文件前几行（默认10行，可用-n指定）
 6. tail 显示文件后几行（默认10行，可用-n指定 -f追踪显示文件更新，一般用于查看日志）

## 硬件信息
  1. lspci 查看pci设备(-v 详细信息)
  2. lsusb 查看USB设备(-v 详细信息)
  3. lsmod 查看加载的模块（驱动）

## 关机、重启
 1. shutdown 
    > -h 关机
    > -r 重启
    > -h now 立即关机
    > -h +10 十分钟之后关机
    > -h 20:20 20:2关机
 2. poweroff 立即关机
 3. reboot 立即重启

## 归档 压缩
 1. zip 文件名  压缩文件
 2. unzip 文件名 解压
 3. gziip 文件名 压缩 
 4. tar 归档命令（打包文件）
  > tar -cvf 文件包名（.tar） 打包文件 归档
  > tar -xvf 文件包名（.tar）  解归档
  > tar -cvzf 文件包名（.tar.gz）归档后压缩

## 查找
1. locate 关键字 此命令需要预先建立数据库 数据库默认更新一次，通过updatedb手动更新数据库（新创建文件查不到，需要先更细）
2. find 查找位置 查找参数（保证实时性，速度慢）
 > . -name*linux* 查找当前所有文件名包含linux的文件
 > .name*.conf 文件后缀查找
 > /-perm777 所有权限是777的文件
 > /-type d 查找目录
 > /-type l 查找链接
 > .name "a*"-exec ls -l{};将当前目录下名以a开头的文件作为参数传递给ls -l
```bash
-name 文件名称
-perm 基于权限
-user 基于用户
-group 基于组
-ctime 基于修改时间
-type 基于类型
-size 基于文件大小
```

# 八、 VI VIM编辑器

命令行下的文本编辑器，支持绝大多数操作系统。VIM是VI的增强版。

## VIM编辑器
1. vim 文件名（有则打开，没有则创建）
2. 拥有代码高亮
3. 三种模式：
> 命令模式：（默认，esc退回此模式）完成选择、复制、粘贴，按`i`进入插入模式
  ```bash
  i:
  o:
  dd:删除整行
  u:撤销
  yy:复制
  p:黏贴
  数字 yy:复制多行
  r:替换当前字符
  /:查找（按n在关键字间切换
  ```
> ex模式： esc返回命令模式
```bash
:w  保存当前修改
:q  退出
:q! 强制退出
:x  保存并退出
:set num 显示行号
:! 执行系统命令
:sh 切换到命令行 按Ctrl+d返回vim
```

# 九、 磁盘、分区、MBR、GPT

## 磁盘 
* Linux所有设备被抽象成一个文件，保存在/dev目录下
* 命名hd[a-z]、sd[a-z]

## 分区
* 设备名称+分区号 如：sda1是第一块硬盘的第一个分区
* 主流分区机制有两种MBR和GPT
> 1. MBR通常用于使用BIOS的pc设备（苹果的引导是UEFI），支持32和64位系统，支持分区数量有限，不支持超过2T的硬盘。
> 2. 只能创建4个主分区，一个扩展分区会占用一个扩展分区，扩展分区是不可用的，要在扩展分区上创建多个逻辑分区。
> 3. 逻辑分区：Linux最多支持63个IDE分区和15个SCSI分区


* GPT
> 1. 支持2T的磁盘
> 2. 向后兼容MBR
> 3. 必须支持UEFI的硬件上才能使用
> 4. 必须使用64位操作系统
> 5. MAC和Linux系统都支持GPT分区格式
> 6. windows7 64bit、windowServer2008 64bit支持GPT


* FDISK分区工具
是IBM老牌分区工具，支持大部分操作系统，是基于MBR的分区工具，如果使用GPT分区则无法使用fdisk
只有超级用户才能操作
> 1. fdisk -l 显示所有磁盘信息
> 2. fdisk /dev/sda 对目标磁盘进行分区
> 3. 分区后使用partprobe命令让内核更新分区信息，否则需重启才能识别新分区
> 4. proc/partitions文件也可查看分区信息


# 十、 文件系统


操作系统通过文件系统管理文件系统及数据，磁盘会分区需要创建文件系统后才能够为操作系统使用，创建文件系统过程又称之为格式化。
* 没有文件系统设备称之为裸设备
* 常见文件系统有 fat32、NTFS、ext2、ext3、ext4、xfs、HFS等
* 文件系统之间的区别：日志、支持的分区大小、支持的单个文件大小，性能等
* Windows下主流文件系统：NTFS
* Linux下主流文件系统：Ext3、EST4
* Linux支持的其他文件系统：ext2、ext3、ext4、fat(msdos)、vfat、nfs、ios9660、proc、gfs、jfs

## 创建文件系统
```bashx
mke2fs -t ext4/dev/sda3
```
> 常用参数
> -b blocksize 指定文件系统块大小(默认4k)
> -c 建立文件系统时检查坏损块
> -L lable 指定卷标
> -j 建立文件系统日志(ext3、ext4自带文件系统日志，不用创建)

mkfs也可创建文件系统，但支持的参数少，不能进行精细化控制
```bash
mkfs.ext3 /dev/sda3
```
dumpe2fs /dev/sda2 查看sda2分区上的文件系统信息

1. 带日志的文件系统（ext3、ext4) 拥有较强的稳定性，在出现错误时可以进行恢复。
2. 查看分区文件系统详细信息：dumpe2fs dev/sdb1
3. 带日志的文件系统流程：文件系统将准备执行事务的具体内容写入日志，文件系统进行操作，操作成功后将事务具体内容从日志中删除，好处是以外情况下（断电或磁盘故障）可以通过日志进行恢复操作，缺点是会三十一部分性能（日志读写操作）
4. 给文件系统打标签（不加参数是显示） e2label /dev/sda2 [标签名]
5. 检查并修复坏损的文件系统：fsck /dev/sda2
> -y参数不提示直接修复
> -t参数指定文件系统类型（fsck会默认自动判断文件系统类型，如果文件系统损坏严重需使用-t）
6. 对于识别为文件的损坏数据（文件系统无记录）fsck会将该文件放入lost+found目录
7. 系统启动时会对磁盘进行fsck操作
8. 检查文件系统时，设备必须是卸载状态


## LINUX文件系统挂载管理

磁盘分区创建好文件系统之后需要挂载到一个目录下才能使用，mac和windows会自动挂载，一旦创建好文件系统，会自动挂载系统上，Windows上称之为C盘、D盘；Linux需要手动挂载操作，或配置系统自动挂载
###挂载
```bash
mount /dev/sda3(要挂载的分区) /mnt(挂载点)
```
> 常用参数：
> 不带参数的mount命令会显示所有已经挂载的文件系统
> -t 指定文件系统类型
> -o 指定挂载选项
* ro rw 只读或只写的形式挂载，默认是rw
* sync 代表不使用缓存，而是对所有操作直接写入磁盘 
* async 代表使用缓存，默认asyc
* noatime 每次访问不更新文件的访问时间
* atime 每次访问更新文件的访问时间
* remount 重新挂载文件系统
###卸载
```bash
umount /dev/sda3        ==umount /mnt
```
如果出现divice is busy报错，则表示该文件系统正在被使用，无法卸载，可以使用fuser-m/mnt查看文件系统进程。或使用lsof/mnt查看正在使用的文件。
如果当前命令行在要卸载的目录中是不能卸载的，需要切换到其他目录下进行卸载

###自动挂载
配置etc/fstab目录来定义需要自动挂载的文件系统，fstab中每一行代表一个挂载配置，
/dev/sda3  需要挂载的设备
/mnt  挂载点
ext4 文件系统类型
defaults 挂载选项 
o o dump、fsck相关选项
* 要挂在的选项也可以使用LABEL进行识别，使用LABEL=LINUXCAST取代/dev/sda3
* mount -a 命令挂载所有fstab中定义的自动挂载项。











